# Module name
MODNAME = toluaex
MODVERS = 1.0
MODULE = $(MODNAME)

# Objects
OBJS := ltoluaex.o
 
# Documentation
DOCS := doc/*

# Current Version
VERSION=1.0

# Your system. Expands to 'GNU/Linux', 'Cygwin' or 'Msys'
SYSTEM = $(shell uname -o)

# Lua Installation path
ifneq (, $(findstring Msys, $(SYSTEM)))
  LUA=c:/usr/local
else
  LUA=/usr/local
endif

# Distribution stuff
DISTNAME=$(MODULE)-$(VERSION)
ifneq (, $(findstring Msys, $(SYSTEM)))
  EXPORTDIR=c:/usr/local/myexports
  DISTARCH=$(DISTNAME).zip
else
  EXPORTDIR=$(HOME)/exports
  DISTARCH=$(DISTNAME).tar.gz
endif

# Installation Directories
ifneq (, $(findstring Msys, $(SYSTEM)))
  INSTALL_ROOT=c:/usr/local
else
  INSTALL_ROOT=/usr/local
endif
INSTALL_SHARE=$(INSTALL_ROOT)/share/lua/$(LV)
INSTALL_LIB=$(INSTALL_ROOT)/lib/lua/$(LV)
INSTALL_DOC=$(INSTALL_ROOT)/share/doc

# Installation tools
MKDIR = mkdir -p
ifneq (,$(findstring Msys, $(SYSTEM)))
  INSTALL = c:/msys/1.0/bin/install.exe -p
  GIT =  c:/msysgit/msysgit/bin/git.exe
  GZIP = c:/msysgit/msysgit/bin/gzip.exe
else
  INSTALL = install.exe -p
  GIT =  git
  GZIP = gzip
endif
INSTALL_EXEC = $(INSTALL) -m 0755 
INSTALL_DATA = $(INSTALL) -m 0644
RM = rm -rf

# ====================================================== 
# You probably do not need to change anything below 

# Compat-5.1 location
COMPAT=compat-5.1r5

# Lua specifics
LV :=5.1
LX :=51
DEFCOMPAT=-DCOMPAT_H
LUAINC=$(LUA)/include
LUABIN=$(LUA)
LUALIB=$(LUA)

# Platform specific differences
ifneq (, $(findstring Linux, $(SYSTEM)))
  # Linux: need not to link againt Lua libraries
  X := so
  LIBS=
else
  # Cygwin/Mingw: need to link against Lua libraries
  X := dll
  LIBS=-llua$(LV)
endif

# Compiler and Linker
DEF=$(DEFCOMPAT) -DVERSION='"$(VERSION)"'
CC=gcc

LD=gcc
ifneq (, $(findstring Linux, $(SYSTEM)))
  CFLAGS=-I$(LUAINC) -I$(COMPAT) $(DEF) -pedantic -Wall -O3 -fPIC
  LDFLAGS=-O -shared -fPIC -L$(LUALIB)
else
  CFLAGS=-I$(LUAINC) -I$(COMPAT) $(DEF) -pedantic -Wall -O3
  LDFLAGS=-O -shared -L$(LUALIB)
endif


