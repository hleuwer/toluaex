#
# Module name
#
MODNAME = toluaex
MODVERS = 1.0
MODULE = $(MODNAME)

#
# Current Version
#
VERSION=1.0

#
# Lua Installation path
#
ifneq (, $(findstring Msys, $(SYSTEM)))
  LUA="c:/usr/local"
else
  LUA=/usr/local
endif

#
# Root of Lua Installation
#
ifneq (, $(findsring Msys, $(SYSTEM)))
  INSTALL_ROOT=c:/usr/local
else
  INSTALL_ROOT=/usr/local
endif
INSTALL_SHARE=$(INSTALL_ROOT)/share/lua/$(LUAVERS)
INSTALL_LIB=$(INSTALL_ROOT)/lib/lua/$(LUAVERS)


# ====================================================== 
# You probably do not need to change anything below 
#

#
# Your system. Expands to 'GNU/Linux', 'Cygwin' or 'Msys'
#
SYSTEM = $(shell uname -o)

#
# Compat-5.1 location
#
COMPAT=compat-5.1r5

#
# Lua specifics
#
V :=5.1
X :=51
DEFCOMPAT=-DCOMPAT_H
LUAINC=$(LUA)/include
LUABIN=$(LUA)
LUALIB=$(LUA)


# 
# Platform specific differences
#
ifneq (, $(findstring Linux, $(SYSTEM)))
  # Linux: need not to link againt Lua libraries
  X = so
  LIBS=
else
  # Cygwin/Mingw: need to link against Lua libraries
  X = dll
  LIBS=-llua$V
endif

#
# Compiler and Linker
#
DEF=$(DEFCOMPAT) -DVERSION='"$(VERSION)"'
CC=gcc
#CFLAGS=-I$(LUAINC) -I$(COMPAT) $(DEF) -pedantic -Wall -O3
CFLAGS=-I$(LUAINC) -I$(COMPAT) $(DEF) -pedantic -Wall -ggdb -fPIC
LD=gcc
ifneq (, $(findstring Linux, $(SYSTEM)))
  LDFLAGS=-O -shared -fPIC
else
  LDFLAGS=-O -shared
endif

#
# Distribution stuff
#
DISTNAME=$(MODULE)-$(VERSION)
ifneq (, $(findstring Msys, $(SYSTEM)))
  EXPORTDIR=c:/usr/local/myexports
  DISTARCH=$(DISTNAME).zip
else
  EXPORTDIR=$(HOME)/exports
  DISTARCH=$(DISTNAME).tar.gz
endif
